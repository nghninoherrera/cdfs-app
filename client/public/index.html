<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDSF Word Lookup</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body className="bg-gray-100 font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const App = () => {
      const [word, setWord] = React.useState('');
      const [sentence, setSentence] = React.useState('');
      const [result, setResult] = React.useState(null);
      const [matches, setMatches] = React.useState([]);
      const [selectedWord, setSelectedWord] = React.useState(null);
      const [error, setError] = React.useState('');
      const [loading, setLoading] = React.useState(false);

      // Handle single-word lookup
      const handleWordSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');
        setResult(null);
        setSelectedWord(null);

        try {
          const response = await fetch('https://cdfs-backend.onrender.com/lookup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ word })
          });
          const data = await response.json();
          setResult(data);
        } catch (err) {
          setError('Error connecting to the server. Please ensure the Flask server is running.');
        } finally {
          setLoading(false);
        }
      };

      // Handle sentence input and detect matches
      React.useEffect(() => {
  if (!sentence.trim()) {
    setMatches([]);
    setSelectedWord(null);
    setResult(null);
    return;
  }

  const timeout = setTimeout(() => {
    setLoading(true);
    setError('');
    setMatches([]);
    setSelectedWord(null);
    setResult(null);

    fetch('https://cdfs-backend.onrender.com/detect', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ sentence })
    })
      .then(response => response.json())
      .then(data => {
        setMatches(data.matches);
        setLoading(false);
      })
      .catch(err => {
        setError('Error processing sentence. Please ensure the Flask server is running.');
        setLoading(false);
      });
  }, 500); // Wait 500ms after user stops typing

  return () => clearTimeout(timeout);
}, [sentence]);


      // Handle clicking a hyperlinked word
      const handleWordClick = (matchedWord, data) => {
        setSelectedWord(matchedWord);
        setResult({ found: true, data });
      };

      // Handle clear button click
      const handleClear = () => {
        setSentence('');
        setMatches([]);
        setSelectedWord(null);
        setResult(null);
      };

      // Render sentence with hyperlinked matched words
      const renderSentenceWithLinks = () => {
        if (!sentence.trim()) return null;
        let parts = sentence.split(/(\b\w+\b)/);
        return parts.map((part, index) => {
          const match = matches.find(m => m.word.toLowerCase() === part.toLowerCase());
          if (match) {
            return (
              <a
                key={index}
                href="#"
                className="text-blue-600 underline font-semibold"
                onClick={(e) => {
                  e.preventDefault();
                  handleWordClick(match.matched_word, match.data);
                }}
              >
                {part}
              </a>
            );
          }
          return <span key={index}>{part}</span>;
        });
      };

      return (
        <div className="container mx-auto p-6 max-w-4xl">



               <div className="flex items-center space-x-4 bg-blue-900 px-4 py-2 rounded mb-6">
      <img src="NEUST.webp" className="w-12 h-12 object-contain" />
            <div className="flex flex-col">

            <h2 className="text-2xl font-bold text-yellow-100">Nueva Ecija University of Science and Technology</h2>
            <p className="text-yellow-100 text-sm">Cabanatuan City</p>
            </div>
      </div>
<h2 className="text-center text-1xl font-bold text-green-800 mb-6">Research Project of: College of Education and the College of Information and Communications Technology</h2>

<h1 className="text-center text-1xl font-bold text-red-800 mb-6">CONTEXTUAL DIACHRONIC SEMANTIC FRAMEWORK (CDSF) FOR LITERARY INTERPRETATION: A THEORETICAL MODEL FOR TRACING WORD MEANING EVOLUTION IN ENGLISH HISTORICAL TEXTS</h1>
<br></br>
          {/* Single Word Lookup */}
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-semibold text-gray-700 mb-4">Single Word Lookup</h2>
            <form onSubmit={handleWordSubmit} className="flex flex-col gap-4">
              <label htmlFor="word-input" className="text-lg font-semibold text-gray-700">
                Enter a Word
              </label>
              <input
                id="word-input"
                type="text"
                value={word}
                onChange={(e) => setWord(e.target.value)}
                placeholder="e.g., salvage, grace"
                className="p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <button
                type="submit"
                disabled={loading}
                className="bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400"
              >
                {loading ? 'Searching...' : 'Search'}
              </button>
            </form>
          </div>

          {/* Sentence Input */}
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-semibold text-gray-700 mb-4">Sentence Analysis</h2>
            <label htmlFor="sentence-input" className="text-lg font-semibold text-gray-700">
              Enter or Paste a Sentence
            </label>
            <textarea
              id="sentence-input"
              value={sentence}
              onChange={(e) => setSentence(e.target.value)}
              placeholder="e.g., The grace and virtue of the knight inspired hope."
              className="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-24"
            />
            <div className="flex gap-4 mt-4">
              <button
                onClick={handleClear}
                className="bg-gray-500 text-white p-2 rounded-md hover:bg-gray-600"
              >
                Clear
              </button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              This application uses Natural Language Processing (NLP) techniques, including a lookup-based model with fuzzy matching, to detect and analyze words.
            </p>
            {sentence.trim() && (
              <div className="mt-4">
                <p className="text-gray-700 font-semibold">Detected Words:</p>
                <p className="text-gray-700">{renderSentenceWithLinks()}</p>
              </div>
            )}
          </div>

          {/* Error Message */}
          {error && (
            <div className="bg-red-100 p-4 rounded-md text-red-700 mb-6">
              {error}
            </div>
          )}

          {/* Selected Word and CDSF Table */}
          {selectedWord && result && result.found && (
            <div className="bg-white p-6 rounded-lg shadow-md mb-6">
              <p className="text-lg font-semibold text insignia-700 mb-4">
                "{selectedWord}" is selected word
              </p>
              <h2 className="text-2xl font-semibold text-blue-600 mb-4">CDSF Analysis for "{selectedWord}"</h2>
              <table className="w-full border-collapse">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border p-2 text-left">CDSF Layer</th>
                    <th className="border p-2 text-left">Details</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(result.data).map(([layer, details]) => (
                    <tr key={layer} className="border-b">
                      <td className="border p-2 font-medium">{layer}</td>
                      <td className="border p-2">{details}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          {/* Single Word Result */}
          {result && !selectedWord && (
            <div className="bg-white p-6 rounded-lg shadow-md">
              {result.found ? (
                <div>
                  <h2 className="text-2xl font-semibold text-blue-600 mb-4">CDSF Analysis for "{word}"</h2>
                  <table className="w-full border-collapse">
                    <thead>
                      <tr className="bg-blue-100">
                        <th className="border p-2 text-left">CDSF Layer</th>
                        <th className="border p-2 text-left">Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      {Object.entries(result.data).map(([layer, details]) => (
                        <tr key={layer} className="border-b">
                          <td className="border p-2 font-medium">{layer}</td>
                          <td className="border p-2">{details}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              ) : (
                <p className="text-gray-700">{result.message}</p>
              )}
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>